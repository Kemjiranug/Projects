<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jelly Bunny - Men's Fashion</title>
    <link rel="stylesheet" href="/css/edit.css">
    <script src="/js/cookie.js"></script>

</head>

<body>
    <header>
        <!-- Header -->
        <div class="top-banner">
            Summer Sale For All Swim Suits And Free Express Delivery-OFF 50% <a href="#">ShopNow</a>
        </div>

        <nav class="navbar">
            <div class="logo">
                <img src="https://jellybunny.com/cdn/shop/files/logo_aa9174d7-06db-4efe-ba2f-8af4e4f9c6f1.png?v=1726717153&width=120"
                    width="80" alt="jellybunny" />
            </div>

            <ul class="nav-links">
                <li><a href="/homepage">Home</a></li>
                <li><a href="/product">Product</a></li>
                <li><a href="/team">Team</a></li>
                <li><a href="/edit">Edit</a></li>
                <li id="btSignOut"><a href="#" onclick="SignOut()">Sign Out</a></li>
            </ul>

            <div class="nav-icons">
                <a href="/search"><img
                        src="https://cdn.builder.io/api/v1/image/assets/TEMP/74d610171b49cc3b18b456fe06d02bff2a8f09126ee10249b3afcbc71e046e51?apiKey=17a27039907c49e7b5a6c90c007a4cde&"
                        width="20" alt="Search" /></a>
                <a href="/sign-in"><img src="https://img.icons8.com/ios-glyphs/30/user.png" width="20"
                        alt="Profile"></a>
                <img src="/picture/cart.png" width="20" alt="Cart"></a>
            </div>
        </nav>
    </header>

    <main>
        <div class="product-list-container"></div>

        <script>

            window.addEventListener('load', function () {
                let loginStatus = getCookie("loginStatus");
                if (loginStatus == 'true') {
                    document.getElementById("btSignOut").style.display = "block";
                    fetchProductData();
                } else {
                    document.getElementById("btSignOut").style.display = "none";
                    window.location.href = "http://localhost:3300/sign-in";

                }

            });


            function SignOut() {
                deleteCookie("loginStatus");
                window.location.href = "http://localhost:3300/homepage";

            }

            function fetchProductData() {
                const url = 'http://localhost:8000/select';

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        const productListContainer = document.querySelector('.product-list-container');
                        productListContainer.innerHTML = '';

                        let row = document.createElement('div');
                        row.classList.add('Row');

                        data.forEach(product => {
                            const column = document.createElement('div');
                            column.classList.add('column');

                            const imageContainer = document.createElement('div');
                            imageContainer.classList.add('image-container');
                            const productImage = document.createElement('img');
                            productImage.src = product.prod_pic1;
                            productImage.alt = product.prod_name;
                            imageContainer.appendChild(productImage);

                            const productDetails = document.createElement('div');
                            productDetails.classList.add('product-details');
                            productDetails.innerHTML = `
                                <h3 class="product-title">${product.prod_name}</h3>
                                <p class="product-price">à¸¿${product.prod_price}</p>
                                <p class="product-description">${product.prod_description}</p>
                            `;

                            // Create the tool (small images at the top right corner)
                            const toolContainer = document.createElement('div');
                            toolContainer.classList.add('tool-container');

                            // Create the Delete icon
                            const toolImage1 = document.createElement('img');
                            toolImage1.src = '/picture/delete.png'; // Delete icon
                            toolImage1.alt = 'Delete';
                            toolImage1.classList.add('tool-image');
                            toolImage1.onclick = function () { openPopup(product.prod_ID); }; // Open popup for deletion

                            // Create the Pencil (Edit) icon
                            const toolImage2 = document.createElement('img');
                            toolImage2.src = '/picture/pencil.png'; // Edit icon
                            toolImage2.alt = 'Edit';
                            toolImage2.classList.add('tool-image');
                            toolImage2.onclick = function () {
                                // Change the page to the edit page with product ID as a query parameter
                                window.location.href = `/edit-product?id=${product.prod_ID}`; // Redirect to edit page
                            };

                            toolContainer.appendChild(toolImage1);
                            toolContainer.appendChild(toolImage2);

                            // Append the tool container to the image container
                            imageContainer.appendChild(toolContainer);

                            column.appendChild(imageContainer);
                            column.appendChild(productDetails);

                            column.addEventListener('click', function () {

                            });

                            row.appendChild(column);

                            if (row.children.length === 2) {
                                productListContainer.appendChild(row);
                                row = document.createElement('div');
                                row.classList.add('Row');
                            }
                        });

                        if (row.children.length > 0) {
                            productListContainer.appendChild(row);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }


            // Popup functions
            function openPopup(productId) {
                document.getElementById("popup").style.display = "block";
                document.getElementById("overlay").style.display = "block";

                window.productToDelete = productId; // Store the product to delete

            }

            function closePopup() {
                document.getElementById("popup").style.display = "none";
                document.getElementById("overlay").style.display = "none";
            }

            function confirmDelete() {
                const sku = window.productToDelete;
                fetch(`http://localhost:8000/delete_product?sku=${sku}`, {
                    method: 'DELETE'
                })
                    .then(response => {
                        if (response.ok) {
                            console.log(`Product with SKU ${sku} deleted successfully.`);
                            // After successful deletion, fetch updated product data
                            //const selectedCategory = document.getElementById('Category-select').value;
                            //const selectedSortingOption = document.getElementById('Sort').value;
                            //fetchProductData(selectedCategory, selectedSortingOption);
                            fetchProductData();
                        } else {
                            console.error(`Failed to delete product with SKU ${sku}.`);

                        }
                        // Hide the delete confirmation popup regardless of the response
                        closePopup();
                    })
                    .catch(error => {
                        console.error('Error deleting product:', error);
                        // Hide the delete confirmation popup in case of an error
                        closePopup();
                    });

                console.log("Item with ID " + window.productToDelete + " will be deleted.");
                // Here you can send a request to the server to delete the product

            }



        </script>

        <!-- Overlay background -->
        <div id="overlay" class="overlay" onclick="closePopup()"></div>

        <!-- Popup box -->
        <div id="popup" class="popup">
            <p>Do you want to delete this item?</p>
            <button class="cancel" onclick="closePopup()">CANCEL</button>
            <button class="confirm" onclick="confirmDelete()">CONFIRM</button>
        </div>
        <a href="/add">
            <button class="add">
                <img src="/picture/add.png" alt="Add">
            </button>
        </a>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-column">
                <h4>Customer Support</h4>
                <ul>
                    <li><a href="#">FAQs</a></li>
                    <li><a href="#">Store Location</a></li>
                    <li><a href="#">Team</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>About Us</h4>
                <ul>
                    <li><a href="#">Terms of Conditions</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-column news">
                <h4>Newsletter</h4>
                <p>Sign up to receive offers:</p>
                <input type="email" placeholder="Enter your email" />
            </div>
        </div>
        <p class="copyright">&copy; Copyright JellyBunny, all rights reserved.</p>
    </footer>
</body>

</html>